<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>çŒœæ­Œè©éŠæˆ²</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    .lyrics {
      margin-top: 20px;
      line-height: 2em;
    }
    .char {
      display: inline-block;
      width: 1.5em;
      height: 1.5em;
      margin: 2px;
      background-color: black;
      color: black;
      border: 1px solid white;
      transition: 0.2s;
    }
    .revealed {
      background-color: transparent;
      color: white;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 300px;
      margin-top: 20px;
    }
    #log {
      margin-top: 10px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h1>ğŸµ çŒœæ­Œè©éŠæˆ² ğŸµ</h1>
  <input id="input" placeholder="è¼¸å…¥ä¸€å€‹å­— æˆ– çŒœæ­Œå">
  <div id="log"></div>
  <div class="lyrics" id="lyrics"></div>
  <div id="guessed"></div>
  <script>


    const lyricsContainer = document.getElementById("lyrics");
    const log = document.getElementById("log");
    const input = document.getElementById("input");
    const geussed =document.getElementById("guessed");
    let guessedChars = new Set();
    let guessCount = 0;
    let lyrics;
    let singer = "";
    let full_lyrics = ""
    let songTitle = ""
    let init_needed = true;
    async function get_lyrics()
    {
      var r = await fetch("https://lyricsmelon.948794harvey.workers.dev/").then(response => response.json());

      await console.log(r)
      return r;
    }

    // åˆå§‹åŒ–æ­Œè©æ¬„ä½
    async function renderLyrics() {
      if(init_needed)
      {
        var question = await get_lyrics();
        console.log(question)
        singer = question["singer"];
        songTitle = question["song_name"];
        lyrics = question["lyrics"];
        full_lyrics = lyrics.join("");
        console.log("lyrics",lyrics);
        init_needed = false;
      }
      lyricsContainer.innerHTML = '';
      for (let sentence of lyrics) {
        for(let char of sentence)
        {
          const span = document.createElement('span');
          span.className = 'char';
          if (guessedChars.has(char) || char === ' ') {
            span.classList.add('revealed');
            span.textContent = char;
          } else {
            span.textContent = 'ã€€'; // å…¨å½¢ç©ºç™½ç¶­æŒå¯¬åº¦
          }
          lyricsContainer.appendChild(span);
        }
        lyricsContainer.appendChild(document.createElement('br'));
      }
    }

    // è™•ç†è¼¸å…¥
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const value = input.value.trim();
        input.value = '';
        if (!value) return;

        guessCount++;

        if (value.length === 1) {
          if(guessedChars.has(value))
          {
            log.textContent = `é€™å€‹å­—å·²ç¶“å•éäº†!`
          }
          else if (full_lyrics.includes(value)) {
            guessedChars.add(value);
            renderLyrics();
            log.textContent = `ç™¼ç¾æ­Œè©ä¸­æœ‰ã€Œ${value}ã€é€™å€‹å­—ï¼(å…±çŒœäº† ${guessCount} æ¬¡)`;
          }
          else {
            log.textContent = `æ­Œè©ä¸­æ²’æœ‰ã€Œ${value}ã€é€™å€‹å­—å–”ï½ (å…±çŒœäº† ${guessCount} æ¬¡)`;
          }
          guessed.textContent = Array.from(guessedChars).join(" ");
        } else {
          if (value === songTitle) {
            log.textContent = `ğŸ‰ æ­å–œä½ çŒœåˆ°æ­£ç¢ºçš„æ­Œåï¼šã€Œ${songTitle}ã€ï¼ä½ ç¸½å…±çŒœäº† ${guessCount} æ¬¡`;
            guessedChars = new Set(lyrics); // å…¨éƒ¨é¡¯ç¤º
            renderLyrics();
          } else {
            log.textContent = `ä¸æ˜¯é€™é¦–æ­Œ ğŸ˜¢`;
          }
        }
      }
    });

    renderLyrics();
	
  </script>
</body>
</html>
